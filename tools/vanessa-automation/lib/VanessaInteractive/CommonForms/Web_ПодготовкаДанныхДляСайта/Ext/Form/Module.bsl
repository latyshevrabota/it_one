
#Область ОписаниеПеременных
// Не обязательная область
#КонецОбласти

#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	МакетБиблиотекиJavaScript = Обработки.VanessaAutomationsingle.ПолучитьМакет("БиблиотекаJavaScript");
	МестоположениеБиблиотекиJavaScript = ПоместитьВоВременноеХранилище(МакетБиблиотекиJavaScript, УникальныйИдентификатор);
	
	Макет_script_js = ПолучитьОбщийМакет("Web_script_js");
	Местоположение_script_js = ПоместитьВоВременноеХранилище(Макет_script_js, УникальныйИдентификатор);
	
	Макет_enjoyhint_css = ПолучитьОбщийМакет("Web_enjoyhint_css");
	Местоположение_enjoyhint_css = ПоместитьВоВременноеХранилище(Макет_enjoyhint_css, УникальныйИдентификатор);
	
	Макет_enjoyhint_min_js = ПолучитьОбщийМакет("Web_enjoyhint_min_js");
	Местоположение_enjoyhint_min_js = ПоместитьВоВременноеХранилище(Макет_enjoyhint_min_js, УникальныйИдентификатор);
	
	Макет_IndexHTML = ПолучитьОбщийМакет("Web_IndexHTML");
	Местоположение_IndexHTML = ПоместитьВоВременноеХранилище(Макет_IndexHTML, УникальныйИдентификатор);
	
	Макет_casino_hand_webfont_ttf = ПолучитьОбщийМакет("Web_casino_hand_webfont_ttf");
	Местоположение_casino_hand_webfont_ttf = ПоместитьВоВременноеХранилище(Макет_casino_hand_webfont_ttf, УникальныйИдентификатор);
	
	Макет_casino_hand_webfont_woff = ПолучитьОбщийМакет("Web_casino_hand_webfont_woff");
	Местоположение_casino_hand_webfont_woff = ПоместитьВоВременноеХранилище(Макет_casino_hand_webfont_woff, УникальныйИдентификатор);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовШапкиФормы

&НаКлиенте
Процедура ПутьВыгрузкиНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	ВыбратьКаталог();
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Асинх Процедура Выгрузить(Команда)
	
	#Если НЕ ВебКлиент Тогда
	
	Если Не ПроверитьЗаполнение() Тогда
		Возврат;
	КонецЕсли;
	
	АрихивБиблиотекиJavaScript = ПолучитьИзВременногоХранилища(МестоположениеБиблиотекиJavaScript);
	ЧтениеZipФайла = Новый ЧтениеZipФайла(АрихивБиблиотекиJavaScript.ОткрытьПотокДляЧтения());
	МассивЭлементовБиблиотеки = Новый Массив;
	Для Каждого ЭлементZipФайла из ЧтениеZipФайла.Элементы Цикл
		//Первым должен быть вызван jQuery, это важно!!!
		Если ЭлементZipФайла.Имя = "jquery.min.js" Или ЭлементZipФайла.Имя = "jquery-ui.min.js" Тогда
			//МассивЭлементовБиблиотеки.Вставить(0, ЭлементZipФайла);
			Продолжить;
		Иначе
			МассивЭлементовБиблиотеки.Добавить(ЭлементZipФайла);
		КонецЕсли;
	КонецЦикла;
	
	ШаблонПутей = "%1/%2";
	ПутьВыгрузкиJSБиблиотеки = СтрШаблон(ШаблонПутей, ПутьВыгрузки, "js");
	
	Для Каждого ЭлементZipФайла из МассивЭлементовБиблиотеки Цикл
		ЧтениеZipФайла.Извлечь(ЭлементZipФайла, ПутьВыгрузкиJSБиблиотеки, РежимВосстановленияПутейФайловZIP.Восстанавливать);
	КонецЦикла;
	
	ЧастиАдресаПубликации = СтрРазделить(АдресПубликацииИБ, "/");
	
	script_js = ПолучитьИзВременногоХранилища(Местоположение_script_js);
	Текст_script_js = script_js.ПолучитьТекст();
	Текст_script_js = СтрЗаменить(Текст_script_js, "%1", ЧастиАдресаПубликации[0]);
	Текст_script_js = СтрЗаменить(Текст_script_js, "%2", ЧастиАдресаПубликации[1]);
	script_js.УстановитьТекст(Текст_script_js);
	Ждать script_js.ЗаписатьАсинх(СтрШаблон(ШаблонПутей, ПутьВыгрузкиJSБиблиотеки, "script.js"));
	
	enjoyhint_css = ПолучитьИзВременногоХранилища(Местоположение_enjoyhint_css);
	Ждать enjoyhint_css.ЗаписатьАсинх(СтрШаблон(ШаблонПутей, ПутьВыгрузкиJSБиблиотеки, "enjoyhint.css"));
	
	//enjoyhint_min_js = ПолучитьИзВременногоХранилища(Местоположение_enjoyhint_min_js);
	//Ждать enjoyhint_min_js.ЗаписатьАсинх(СтрШаблон(ШаблонПутей, ПутьВыгрузкиJSБиблиотеки, "enjoyhint.min.js"));
	
	IndexHTML = ПолучитьИзВременногоХранилища(Местоположение_IndexHTML);
	Текст_IndexHTML = IndexHTML.ПолучитьТекст();
	Текст_IndexHTML = СтрЗаменить(Текст_IndexHTML, "%1", ЧастиАдресаПубликации[0]);
	Текст_IndexHTML = СтрЗаменить(Текст_IndexHTML, "%2", ЧастиАдресаПубликации[1]);
	IndexHTML.УстановитьТекст(Текст_IndexHTML);
	Ждать IndexHTML.ЗаписатьАсинх(СтрШаблон(ШаблонПутей, ПутьВыгрузки, "Index.HTML"));
	
	ПутьДляРесурсов = СтрШаблон(ШаблонПутей, ПутьВыгрузки, "src");
	
	casino_hand_webfont_ttf = ПолучитьИзВременногоХранилища(Местоположение_casino_hand_webfont_ttf);
	Ждать casino_hand_webfont_ttf.ЗаписатьАсинх(СтрШаблон(ШаблонПутей, ПутьДляРесурсов, "casino.hand.webfont.ttf"));
	
	casino_hand_webfont_woff = ПолучитьИзВременногоХранилища(Местоположение_casino_hand_webfont_woff);
	Ждать casino_hand_webfont_woff.ЗаписатьАсинх(СтрШаблон(ШаблонПутей, ПутьДляРесурсов, "casino.hand.webfont.woff"));
	
	#КонецЕсли
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Асинх Процедура ВыбратьКаталог()
	
	Диалог = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	Диалог.Заголовок = НСтр("ru ='Укажите целевой каталог выгрузки'");
	МассивВыбора = Ждать Диалог.ВыбратьАсинх();
	Если МассивВыбора <> Неопределено Тогда
		ПутьВыгрузки = МассивВыбора[0];
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти
